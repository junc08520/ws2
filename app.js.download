// ./app.js
import { initI18n, t } from "./i18n.js";

const $ = (sel, root = document) => root.querySelector(sel);

// âœ… Replace with your real links before going live
const LINKS = {
  TG: "#",
  WA: "#",
};

// ===== Render =====
function render() {
  // Set title immediately with fallback
  const title = t("meta.title");
  document.title = (title && title !== "meta.title") ? title : "Apex Mining";

  const app = $("#app");
  if (!app) return;
  
  app.innerHTML = `
    ${TopNav()}
    ${Hero()}
    ${WhyChoose()}
    ${OperationMethod()}
    ${Capabilities()}
    ${SafetySecurity()}
    ${VIPLevels()}
    ${ProfitCalculator()}
    ${Partners()}
    ${UserTestimonials()}
    ${FAQ()}
    ${ContactCTA()}
    ${Footer()}
    ${CustomerServiceButtons()}
  `;
}

function TopNav() {
  return `
  <header class="fixed top-0 left-0 right-0 z-[99999]" style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; z-index: 99999 !important; width: 100% !important;">
      <div class="border-b w-full" style="border-color: rgba(148,163,184,.30); background: rgba(30,41,59,.98); backdrop-filter: blur(12px) saturate(180%); -webkit-backdrop-filter: blur(12px) saturate(180%); box-shadow: 0 4px 20px rgba(0,0,0,.3);">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between gap-3">
        <a href="#top" class="flex items-center gap-3 min-w-0">
          <img src="./images/logos/apex-logo.png" alt="Apex Mining" class="w-10 h-10 rounded-2xl flex-shrink-0" />
          <div class="min-w-0">
            <div class="font-extrabold tracking-wide truncate" style="color: #f1f5f9;">${t("brand.name")}</div>
            <div class="text-xs truncate" style="color: #94a3b8;">${t("brand.tagline")}</div>
          </div>
        </a>

        <nav class="hidden lg:flex items-center gap-4 xl:gap-6 text-xs xl:text-sm" style="color:#cbd5e1;">
          <a class="hover:underline whitespace-nowrap" href="#why">${t("nav.why")}</a>
          <a class="hover:underline whitespace-nowrap" href="#operation">${t("nav.how")}</a>
          <a class="hover:underline whitespace-nowrap" href="#vip">${t("nav.vip")}</a>
          <a class="hover:underline whitespace-nowrap" href="#calculator">${t("nav.calculator")}</a>
          <a class="hover:underline whitespace-nowrap" href="#safety">${t("nav.safety")}</a>
          <a class="hover:underline whitespace-nowrap" href="#faq">${t("nav.faq")}</a>
        </nav>

        <div class="flex items-center gap-1.5 sm:gap-2 md:gap-3">
          <div class="relative">
            <button id="langBtn"
              class="inline-flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-xl chip text-xs sm:text-sm font-semibold min-w-[44px] min-h-[44px]">
              <img id="langFlag" src="./images/flags/en.png" alt="Language" class="w-4 h-4 sm:w-5 sm:h-5 rounded flex-shrink-0" />
              <span id="langLabel" class="font-bold hidden sm:inline">EN</span>
              <span class="text-xs" style="color:#94a3b8;">â–¾</span>
            </button>
            <div id="langMenu"
              class="hidden absolute right-0 mt-2 w-40 sm:w-44 rounded-2xl overflow-hidden shadow-xl z-50"
              style="background: rgba(30,41,59,.90); border: 1px solid rgba(148,163,184,.35); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);">
              ${LangItem("en","ğŸ‡ºğŸ‡¸","English (EN)")}
              ${LangItem("ar","ğŸ‡¸ğŸ‡¦","Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (AR)")}
              ${LangItem("es","ğŸ‡ªğŸ‡¸","EspaÃ±ol (ES)")}
              ${LangItem("fr","ğŸ‡«ğŸ‡·","FranÃ§ais (FR)")}
              ${LangItem("de","ğŸ‡©ğŸ‡ª","Deutsch (DE)")}
              ${LangItem("it","ğŸ‡®ğŸ‡¹","Italiano (IT)")}
              ${LangItem("pt","ğŸ‡µğŸ‡¹","PortuguÃªs (PT)")}
              ${LangItem("ja","ğŸ‡¯ğŸ‡µ","æ—¥æœ¬èª (JA)")}
              ${LangItem("ko","ğŸ‡°ğŸ‡·","í•œêµ­ì–´ (KO)")}
              ${LangItem("zh-Hant","ğŸ‡¹ğŸ‡¼","ç¹é«”ä¸­æ–‡")}
            </div>
          </div>

          <a id="btnTGTop" href="#contact" data-chat-type="telegram"
             class="hidden sm:inline-flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-2xl btn-primary font-semibold shadow-lg text-xs sm:text-sm min-h-[36px]">
            ${t("cta.telegram")}
          </a>
          <a id="btnWATop" href="#contact" data-chat-type="whatsapp"
             class="hidden sm:inline-flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-2xl btn-ghost font-semibold text-xs sm:text-sm min-h-[36px]">
            ${t("cta.whatsapp")}
          </a>
        </div>
      </div>
    </div>
  </header>
  `;
}

function LangItem(code, flag, label) {
  const flagMap = {
    "en": "./images/flags/en.png",
    "ar": "./images/flags/ar.png",
    "zh-Hant": "./images/flags/tw.png",
    "es": "./images/flags/es.png",
    "fr": "./images/flags/fr.png",
    "de": "./images/flags/de.png",
    "it": "./images/flags/it.png",
    "pt": "./images/flags/pt.png",
    "ja": "./images/flags/ja.png",
    "ko": "./images/flags/ko.png"
  };
  const flagImg = flagMap[code] || flag;
  return `<button class="w-full text-left px-4 py-3 text-sm flex items-center gap-2 lang-menu-item" style="color:#f1f5f9;" data-lang="${code}">
    <img src="${flagImg}" alt="${code}" class="w-5 h-5 rounded flex-shrink-0" />
    <span>${label}</span>
  </button>`;
}

function Hero() {
  return `
  <section id="top" class="relative pt-20 sm:pt-24">
    <div class="mesh"></div>
    <div class="hero-background absolute inset-0 opacity-20" style="background-image: url('./images/hero/blockchain-network.jpg'); background-size: cover; background-position: center; background-repeat: no-repeat;"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 pt-8 sm:pt-12 md:pt-14 pb-8 sm:pb-10 relative z-10">
      <div class="grid lg:grid-cols-2 gap-6 sm:gap-8 lg:gap-10 items-center">
        <div class="order-2 lg:order-1">
          <div class="inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full chip text-xs sm:text-sm font-semibold">
            <span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #14b8a6;"></span>
            <span style="color:#f1f5f9;">${t("hero.badge")}</span>
          </div>

          <h1 class="mt-4 sm:mt-6 text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-extrabold leading-tight hero-title-gradient">
            <span>${t("hero.titleA")}</span><br/>
            ${t("hero.titleB")}
          </h1>

          <p class="mt-4 sm:mt-5 text-sm sm:text-base md:text-lg" style="color:#cbd5e1; max-width: 44rem;">
            ${t("hero.desc")}
          </p>

          <div class="mt-6 sm:mt-8 flex flex-col sm:flex-row gap-3">
            <a href="#contact" class="px-5 sm:px-6 py-3 sm:py-4 rounded-2xl btn-primary font-semibold text-center shadow-lg text-sm sm:text-base min-h-[44px] flex items-center justify-center">
              ${t("cta.start")}
            </a>
            <a href="#operation" class="px-5 sm:px-6 py-3 sm:py-4 rounded-2xl btn-ghost font-semibold text-center text-sm sm:text-base min-h-[44px] flex items-center justify-center">
              ${t("cta.how")}
            </a>
          </div>

          <div class="mt-6 sm:mt-8 grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 text-xs sm:text-sm">
            ${StatCard(t("hero.stat1.label"), t("hero.stat1.value"))}
            ${StatCard(t("hero.stat2.label"), t("hero.stat2.value"))}
            ${StatCard(t("hero.stat3.label"), t("hero.stat3.value"))}
          </div>

          <div class="mt-4 sm:mt-5 text-xs px-1" style="color:#94a3b8; line-height: 1.5;">
            ${t("hero.note")}
          </div>
          
          <div class="mt-6 sm:mt-8 card rounded-3xl p-4 sm:p-5 md:p-6">
            <div class="flex flex-col gap-3 sm:gap-4">
              <div class="flex-1 min-w-0">
                <div class="proof-strip-title text-xs sm:text-sm md:text-base font-extrabold leading-tight" style="color:#5eead4;">${t("proof.title")}</div>
                <div class="proof-strip-desc mt-1.5 sm:mt-2 text-xs sm:text-sm leading-relaxed" style="color:#94a3b8; line-height: 1.5;">${t("proof.desc")}</div>
              </div>
              <div class="flex flex-wrap gap-2 sm:gap-2.5 mt-1">
                ${Pill(t("proof.p1"))}
                ${Pill(t("proof.p2"))}
                ${Pill(t("proof.p3"))}
                ${Pill(t("proof.p4"))}
              </div>
            </div>
          </div>
        </div>

        <div class="relative order-1 lg:order-2">
          <div class="absolute -inset-2 sm:-inset-4 rounded-3xl blur-2xl" style="background: linear-gradient(90deg, rgba(20,184,166,.25), rgba(6,182,212,.22), rgba(16,185,129,.18));"></div>

          <div class="relative card rounded-3xl p-4 sm:p-6 md:p-8">
            <div class="flex items-start justify-between gap-2 sm:gap-3">
              <div class="min-w-0 flex-1">
                <div class="text-xs font-semibold uppercase tracking-wide" style="color:#94a3b8;">${t("hero.panel.kicker")}</div>
                <div class="mt-1 sm:mt-2 text-lg sm:text-xl md:text-2xl font-extrabold" style="color:#5eead4;">${t("hero.panel.title")}</div>
              </div>
              <div class="px-2 sm:px-3 py-1 sm:py-1.5 rounded-2xl text-xs font-semibold flex-shrink-0" style="background: rgba(20,184,166,.20); color:#5eead4; border:1px solid rgba(20,184,166,.30);">
                ${t("hero.panel.live")}
              </div>
            </div>

            <div class="mt-4 sm:mt-6 grid grid-cols-2 gap-2 sm:gap-3">
              ${Metric(t("hero.panel.m1.label"), t("hero.panel.m1.value"))}
              ${Metric(t("hero.panel.m2.label"), t("hero.panel.m2.value"))}
              ${Metric(t("hero.panel.m3.label"), t("hero.panel.m3.value"))}
              ${Metric(t("hero.panel.m4.label"), t("hero.panel.m4.value"))}
            </div>

            <div class="mt-4 sm:mt-6 rounded-2xl p-3 sm:p-4" style="background: rgba(148,163,184,.12); border:1px dashed rgba(148,163,184,.30);">
              <div class="text-xs font-semibold" style="color:#f1f5f9;">${t("hero.panel.callout.t")}</div>
              <div class="mt-1 text-xs leading-relaxed" style="color:#94a3b8;">${t("hero.panel.callout.d")}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  `;
}

function StatCard(label, value) {
  return `
  <div class="card rounded-2xl p-3 sm:p-4">
    <div class="text-xs font-semibold" style="color:#94a3b8;">${label}</div>
    <div class="mt-1 text-sm sm:text-base font-semibold" style="color:#f1f5f9;">${value}</div>
  </div>`;
}

function Metric(label, value) {
  return `
  <div class="rounded-2xl p-3 sm:p-4" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35);">
    <div class="text-xs font-semibold" style="color:#94a3b8;">${label}</div>
    <div class="mt-1 text-xs sm:text-sm font-semibold" style="color:#f1f5f9;">${value}</div>
  </div>`;
}

function Pill(text) {
  return `<div class="px-2.5 sm:px-3 py-1.5 sm:py-2 rounded-full text-xs font-semibold chip whitespace-nowrap flex-shrink-0" style="color:#f1f5f9;">${text}</div>`;
}

function SafetySecurity() {
  return `
  <section id="safety" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="text-center mb-6 sm:mb-8">
      <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("safetySec.title")}</h2>
      <p class="mt-2 text-xs sm:text-sm md:text-base px-2" style="color:#94a3b8; line-height: 1.6;">${t("safetySec.subtitle")}</p>
    </div>
    
    <div class="grid lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
      <div class="card rounded-3xl p-4 sm:p-6 md:p-8">
        <h3 class="text-lg sm:text-xl md:text-2xl font-extrabold text-center" style="color:#5eead4;">${t("control.title")}</h3>
        <p class="mt-2 sm:mt-3 text-xs sm:text-sm md:text-base text-center" style="color:#cbd5e1; line-height: 1.6;">${t("control.desc")}</p>
        <div class="mt-4 sm:mt-6 grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3">
          ${Bullet(t("control.b1.t"), t("control.b1.d"))}
          ${Bullet(t("control.b2.t"), t("control.b2.d"))}
          ${Bullet(t("control.b3.t"), t("control.b3.d"))}
          ${Bullet(t("control.b4.t"), t("control.b4.d"))}
        </div>
      </div>
      
      <div class="card rounded-3xl p-4 sm:p-6 md:p-8">
        <div class="text-lg sm:text-xl md:text-2xl font-extrabold text-center" style="color:#5eead4;">${t("control.panel.t")}</div>
        <div class="mt-2 sm:mt-3 text-xs sm:text-sm text-center" style="color:#cbd5e1; line-height: 1.6;">${t("control.panel.d")}</div>
        <div class="mt-4 sm:mt-6 rounded-3xl p-4 sm:p-5" style="background: linear-gradient(90deg, rgba(20,184,166,.15), rgba(6,182,212,.12)); border: 1px solid rgba(148,163,184,.30);">
          <div class="flex items-start gap-2 sm:gap-3">
            <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-2xl flex items-center justify-center flex-shrink-0 overflow-hidden" style="background: rgba(30,41,59,.80); border:1px solid rgba(148,163,184,.35);">
              <img src="./images/logos/apex-logo.png" alt="Apex" class="w-full h-full object-contain p-1" />
            </div>
            <div class="min-w-0 flex-1">
              <div class="text-xs sm:text-sm font-bold" style="color:#f1f5f9;">${t("control.panel.c1.t")}</div>
              <div class="mt-1 text-xs leading-relaxed" style="color:#94a3b8;">${t("control.panel.c1.d")}</div>
            </div>
          </div>
          <div class="mt-3 sm:mt-4 grid grid-cols-2 gap-2 sm:gap-3">
            ${MiniMetric(t("control.panel.m1.l"), t("control.panel.m1.v"))}
            ${MiniMetric(t("control.panel.m2.l"), t("control.panel.m2.v"))}
            ${MiniMetric(t("control.panel.m3.l"), t("control.panel.m3.v"))}
            ${MiniMetric(t("control.panel.m4.l"), t("control.panel.m4.v"))}
          </div>
        </div>
      </div>
    </div>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
      ${SafetySecCard(t("safetySec.c1.t"), t("safetySec.c1.d"), "ğŸ”")}
      ${SafetySecCard(t("safetySec.c2.t"), t("safetySec.c2.d"), "ğŸ’¼")}
      ${SafetySecCard(t("safetySec.c3.t"), t("safetySec.c3.d"), "ğŸ“")}
      ${SafetySecCard(t("safetySec.c4.t"), t("safetySec.c4.d"), "ğŸ”")}
      ${SafetySecCard(t("safetySec.c5.t"), t("safetySec.c5.d"), "ğŸ“Š")}
      ${SafetySecCard(t("safetySec.c6.t"), t("safetySec.c6.d"), "ğŸŒ")}
    </div>
  </section>
  `;
}

function Bullet(title, desc) {
  return `
  <div class="rounded-2xl p-3 sm:p-4" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35);">
    <div class="text-xs sm:text-sm font-bold" style="color:#f1f5f9;">${title}</div>
    <div class="mt-1 text-xs leading-relaxed" style="color:#94a3b8;">${desc}</div>
  </div>`;
}
function MiniMetric(l, v) {
  return `
  <div class="rounded-2xl p-2 sm:p-3" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35);">
    <div class="text-xs font-semibold" style="color:#94a3b8;">${l}</div>
    <div class="mt-1 text-xs font-bold" style="color:#f1f5f9;">${v}</div>
  </div>`;
}


function Capabilities() {
  return `
  <section id="cap" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="grid lg:grid-cols-2 gap-4 sm:gap-6 items-start">
      <div class="card rounded-3xl p-4 sm:p-6 md:p-8">
        <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("cap.title")}</h2>
        <p class="mt-2 sm:mt-3 text-xs sm:text-sm md:text-base text-center" style="color:#94a3b8; line-height: 1.6;">${t("cap.desc")}</p>

        <div class="mt-4 sm:mt-6 grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3">
          ${CapItem(t("cap.c1.t"), t("cap.c1.d"))}
          ${CapItem(t("cap.c2.t"), t("cap.c2.d"))}
          ${CapItem(t("cap.c3.t"), t("cap.c3.d"))}
          ${CapItem(t("cap.c4.t"), t("cap.c4.d"))}
        </div>
      </div>

      <div class="card rounded-3xl p-4 sm:p-6 md:p-8">
        <div class="text-lg sm:text-xl md:text-2xl font-extrabold text-center" style="color:#5eead4;">${t("cap.panel.t")}</div>
        <p class="mt-2 sm:mt-3 text-xs sm:text-sm text-center" style="color:#94a3b8; line-height: 1.6;">${t("cap.panel.d")}</p>

        <div class="mt-4 sm:mt-6 space-y-2 sm:space-y-3">
          ${Checklist(t("cap.panel.i1"))}
          ${Checklist(t("cap.panel.i2"))}
          ${Checklist(t("cap.panel.i3"))}
          ${Checklist(t("cap.panel.i4"))}
        </div>
      </div>
    </div>
  </section>
  `;
}
function CapItem(t1, d1) {
  return `
  <div class="rounded-2xl p-3 sm:p-4" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35);">
    <div class="text-xs sm:text-sm font-extrabold" style="color:#f1f5f9;">${t1}</div>
    <div class="mt-1 text-xs leading-relaxed" style="color:#94a3b8;">${d1}</div>
  </div>`;
}
function Checklist(text) {
  return `
  <div class="flex items-start gap-2 sm:gap-3 rounded-2xl p-3 sm:p-4" style="background: rgba(148,163,184,.12); border: 1px solid rgba(148,163,184,.25);">
    <div class="w-5 h-5 sm:w-6 sm:h-6 rounded-lg flex items-center justify-center flex-shrink-0" style="background: rgba(20,184,166,.20); border:1px solid rgba(20,184,166,.30);">
      <span class="text-xs sm:text-sm" style="color:#5eead4; font-weight: 900;">âœ“</span>
    </div>
    <div class="text-xs sm:text-sm leading-relaxed" style="color:#cbd5e1;">${text}</div>
  </div>`;
}


function FAQ() {
  return `
  <section id="faq" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="flex items-end justify-between flex-wrap gap-3">
      <div class="flex-1">
        <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("faq.title")}</h2>
        <p class="mt-2 text-xs sm:text-sm md:text-base text-center" style="color:#94a3b8; line-height: 1.6;">${t("faq.desc")}</p>
      </div>
    </div>

    <div class="mt-4 sm:mt-6 space-y-2 sm:space-y-3">
      ${FAQItem(t("faq.q1.q"), t("faq.q1.a"))}
      ${FAQItem(t("faq.q2.q"), t("faq.q2.a"))}
      ${FAQItem(t("faq.q3.q"), t("faq.q3.a"))}
      ${FAQItem(t("faq.q4.q"), t("faq.q4.a"))}
      ${FAQItem(t("faq.q5.q"), t("faq.q5.a"))}
      ${FAQItem(t("faq.q6.q"), t("faq.q6.a"))}
      ${FAQItem(t("faq.q7.q"), t("faq.q7.a"))}
      ${FAQItem(t("faq.q8.q"), t("faq.q8.a"))}
    </div>
  </section>
  `;
}
function FAQItem(q, a) {
  return `
  <div class="faq card rounded-3xl overflow-hidden">
    <button class="w-full px-4 sm:px-6 py-4 sm:py-5 text-left flex items-center justify-between gap-3 sm:gap-4">
      <div class="text-xs sm:text-sm md:text-base font-extrabold flex-1 pr-2" style="color:#f1f5f9; line-height: 1.5;">${q}</div>
      <div class="text-lg sm:text-xl flex-shrink-0" style="color:#94a3b8;">+</div>
    </button>
    <div class="px-4 sm:px-6 pb-4 sm:pb-6 hidden">
      <div class="text-xs sm:text-sm leading-relaxed" style="color:#94a3b8; line-height: 1.6;">${a}</div>
    </div>
  </div>`;
}

function ContactCTA() {
  return `
  <section id="contact" class="max-w-7xl mx-auto px-4 sm:px-6 pb-10 sm:pb-14">
    <div class="relative overflow-hidden rounded-3xl p-5 sm:p-7 md:p-10"
      style="background: linear-gradient(90deg, rgba(20,184,166,.20), rgba(6,182,212,.18), rgba(16,185,129,.15)); border:1px solid rgba(148,163,184,.30);">
      <div class="absolute -inset-12 sm:-inset-24 blur-3xl" style="background: radial-gradient(circle at 30% 20%, rgba(20,184,166,.25), transparent 55%), radial-gradient(circle at 70% 30%, rgba(6,182,212,.22), transparent 55%);"></div>
      <div class="relative">
        <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("contact.title")}</h2>
        <p class="mt-2 text-xs sm:text-sm md:text-base text-center mx-auto" style="color:#cbd5e1; max-width: 52rem; line-height: 1.6;">${t("contact.desc")}</p>

        <div class="mt-4 sm:mt-6 flex flex-col sm:flex-row gap-3 justify-center">
          <a id="btnTGCTA" href="#"
            data-chat-type="telegram"
            class="px-5 sm:px-6 py-3 sm:py-4 rounded-2xl btn-primary font-semibold text-center shadow-lg text-sm sm:text-base min-h-[44px] flex items-center justify-center">
            ${t("contact.tg")}
          </a>
          <a id="btnWACTA" href="#"
            data-chat-type="whatsapp"
            class="px-5 sm:px-6 py-3 sm:py-4 rounded-2xl btn-ghost font-semibold text-center text-sm sm:text-base min-h-[44px] flex items-center justify-center">
            ${t("contact.wa")}
          </a>
        </div>
      </div>
    </div>
  </section>
  `;
}

function Footer() {
  return `
    <footer class="border-t" style="border-color: rgba(148,163,184,.30); background: rgba(30,41,59,.85); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-10">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 items-start">
        <div class="flex items-center gap-2 sm:gap-3">
          <img src="./images/logos/apex-logo.png" alt="Apex Mining" class="w-8 h-8 sm:w-10 sm:h-10 rounded-2xl flex-shrink-0" />
          <div>
            <div class="text-sm sm:text-base font-extrabold" style="color:#f1f5f9;">${t("brand.name")}</div>
            <div class="text-xs" style="color:#94a3b8;">${t("footer.tagline")}</div>
          </div>
        </div>

        <div class="text-xs sm:text-sm" style="color:#94a3b8; line-height: 1.6;">
          <div>${t("footer.disclaimer")}</div>
          <div class="mt-2 sm:mt-3 text-xs" style="color:#64748b;">Â© <span id="year"></span> ${t("footer.rights")}</div>
        </div>
      </div>
    </div>
  </footer>
  `;
}

function WhyChoose() {
  return `
  <section id="why" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="text-center mb-6 sm:mb-8">
        <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("why.title")}</h2>
      <p class="mt-2 text-xs sm:text-sm md:text-base px-2" style="color:#94a3b8;">${t("why.subtitle")}</p>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
      ${WhyCard(t("why.c1.t"), t("why.c1.d"), "ğŸ”’")}
      ${WhyCard(t("why.c2.t"), t("why.c2.d"), "ğŸ”")}
      ${WhyCard(t("why.c3.t"), t("why.c3.d"), "âš¡")}
      ${WhyCard(t("why.c4.t"), t("why.c4.d"), "ğŸ¤–")}
      ${WhyCard(t("why.c5.t"), t("why.c5.d"), "ğŸ’")}
      ${WhyCard(t("why.c6.t"), t("why.c6.d"), "ğŸ‘¥")}
    </div>
  </section>
  `;
}
function WhyCard(title, desc, iconKey) {
  const titleText = title || "";
  const descText = desc || "";
  if (!titleText && !descText) return "";
  
  const iconMap = {
    "ğŸ”’": "./images/icons/lock-security.png",
    "ğŸ”": "./images/icons/search-verify.png",
    "âš¡": "./images/icons/lightning-fast.png",
    "ğŸ¤–": "./images/icons/robot-auto.png",
    "ğŸ’": "./images/icons/diamond-value.png",
    "ğŸ‘¥": "./images/icons/team-community.png"
  };
  
  const iconImg = iconMap[iconKey] || iconKey;
  const isImage = iconImg.startsWith("./");
  
  return `
  <div class="card rounded-3xl p-4 sm:p-6 min-h-[140px] sm:min-h-[160px] flex flex-col">
    <div class="mb-2 sm:mb-3 flex-shrink-0">
      ${isImage ? `<img src="${iconImg}" alt="${titleText}" class="w-8 h-8 sm:w-10 sm:h-10 object-contain" style="background: transparent;" />` : `<div class="text-2xl sm:text-3xl">${iconKey || "âœ¨"}</div>`}
    </div>
    <div class="text-base sm:text-lg font-extrabold mb-2 flex-shrink-0" style="color:#f1f5f9;">${titleText}</div>
    <div class="text-xs sm:text-sm flex-grow" style="color:#94a3b8; line-height: 1.5;">${descText}</div>
  </div>`;
}

function SafetySecCard(title, desc, iconKey) {
  const iconMap = {
    "ğŸ”": "./images/icons/check-audit.png",
    "ğŸ’¼": "./images/icons/briefcase-asset.png",
    "ğŸ“": "./images/icons/check-verify.png",
    "ğŸ“Š": "./images/icons/chart-monitor.png",
    "ğŸŒ": "./images/icons/shield-protect.png"
  };
  
  const iconImg = iconMap[iconKey] || iconKey;
  const isImage = iconImg.startsWith("./");
  
  return `
  <div class="card rounded-3xl p-4 sm:p-5 min-h-[140px] sm:min-h-[160px] flex flex-col">
    <div class="mb-2 sm:mb-3 flex-shrink-0">
      ${isImage ? `<img src="${iconImg}" alt="${title}" class="w-8 h-8 sm:w-10 sm:h-10 object-contain" style="background: transparent;" />` : `<div class="text-xl sm:text-2xl">${iconKey}</div>`}
    </div>
    <div class="text-xs sm:text-sm font-extrabold mb-2 flex-shrink-0" style="color:#f1f5f9;">${title}</div>
    <div class="text-xs leading-relaxed flex-grow" style="color:#94a3b8;">${desc}</div>
  </div>`;
}

function OperationMethod() {
  return `
  <section id="operation" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="text-center mb-6 sm:mb-8">
        <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("operation.title")}</h2>
      <p class="mt-2 text-xs sm:text-sm md:text-base px-2" style="color:#94a3b8; line-height: 1.6;">${t("operation.subtitle")}</p>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
      ${OperationStep("1", t("operation.s1.t"), t("operation.s1.d"))}
      ${OperationStep("2", t("operation.s2.t"), t("operation.s2.d"))}
      ${OperationStep("3", t("operation.s3.t"), t("operation.s3.d"))}
      ${OperationStep("4", t("operation.s4.t"), t("operation.s4.d"))}
    </div>
  </section>
  `;
}
function OperationStep(n, title, desc) {
  return `
  <div class="card rounded-3xl p-4 sm:p-6">
    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center font-extrabold text-sm sm:text-base mb-3 sm:mb-4 flex-shrink-0" style="background: rgba(20,184,166,.20); color:#5eead4; border:1px solid rgba(20,184,166,.30);">${n}</div>
    <div class="text-base sm:text-lg font-extrabold mb-2" style="color:#f1f5f9;">${title}</div>
    <div class="text-xs sm:text-sm leading-relaxed" style="color:#94a3b8;">${desc}</div>
  </div>`;
}

function VIPLevels() {
  return `
  <section id="vip" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="card rounded-3xl p-4 sm:p-6 md:p-8">
      <div class="text-center mb-6 sm:mb-8">
        <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("vip.title")}</h2>
        <p class="mt-2 text-xs sm:text-sm md:text-base px-2" style="color:#94a3b8; line-height: 1.6;">${t("vip.subtitle")}</p>
      </div>
      <div class="overflow-x-auto -mx-4 sm:mx-0 px-4 sm:px-0" style="scrollbar-width: thin; scrollbar-color: rgba(148,163,184,.3) transparent;">
        <table class="w-full min-w-[500px]" style="border-collapse: separate; border-spacing: 0;">
          <thead>
            <tr>
              <th class="text-center px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-extrabold rounded-tl-2xl" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9;">${t("vip.table.level")}</th>
              <th class="text-center px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-extrabold" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9;">${t("vip.table.amount")}</th>
              <th class="text-center px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-extrabold rounded-tr-2xl" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9;">${t("vip.table.rate")}</th>
            </tr>
          </thead>
          <tbody>
            ${VIPRow("VIP1", t("vip.v1.range"), t("vip.v1.rate"))}
            ${VIPRow("VIP2", t("vip.v2.range"), t("vip.v2.rate"))}
            ${VIPRow("VIP3", t("vip.v3.range"), t("vip.v3.rate"))}
            ${VIPRow("VIP4", t("vip.v4.range"), t("vip.v4.rate"))}
            ${VIPRow("VIP5", t("vip.v5.range"), t("vip.v5.rate"))}
            ${VIPRow("VIP6", t("vip.v6.range"), t("vip.v6.rate"))}
            ${VIPRow("VIP7", t("vip.v7.range"), t("vip.v7.rate"))}
            ${VIPRow("VIP8", t("vip.v8.range"), t("vip.v8.rate"))}
          </tbody>
        </table>
      </div>
    </div>
  </section>
  `;
}
function VIPRow(level, range, rate) {
  // Fallback values if translation fails
  const rateFallback = {
    "VIP1": "2.3%",
    "VIP2": "2.7%",
    "VIP3": "3.5%",
    "VIP4": "4.0%",
    "VIP5": "4.5%",
    "VIP6": "5.0%",
    "VIP7": "6.0%",
    "VIP8": "8.0%"
  };
  const rateValue = (rate && !rate.startsWith("vip.")) ? rate : rateFallback[level] || "â€”";
  return `
  <tr>
    <td class="px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-bold text-center" style="background: rgba(30,41,59,.50); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9;">${level}</td>
    <td class="px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-center" style="background: rgba(30,41,59,.50); border: 1px solid rgba(148,163,184,.35); color:#cbd5e1;">${range}</td>
    <td class="px-2 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-bold text-center" style="background: rgba(30,41,59,.50); border: 1px solid rgba(148,163,184,.35);">
      <span class="text-grad">${rateValue}</span>
    </td>
  </tr>`;
}

function ProfitCalculator() {
  return `
  <section id="calculator" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="text-center mb-6 sm:mb-8">
      <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("calc.title")}</h2>
      <p class="mt-2 text-xs sm:text-sm md:text-base px-2" style="color:#94a3b8; line-height: 1.6;">${t("calc.subtitle")}</p>
    </div>
    <div class="grid lg:grid-cols-2 gap-4 sm:gap-6">
      <div class="card rounded-3xl p-4 sm:p-6 md:p-8">
        <h3 class="text-lg sm:text-xl font-extrabold mb-4 sm:mb-6 text-center" style="color:#5eead4;">${t("calc.input.title")}</h3>
        <div class="space-y-3 sm:space-y-4">
          <div>
            <label class="text-xs sm:text-sm font-semibold block mb-2" style="color:#cbd5e1;">${t("calc.input.amount")}</label>
            <div class="flex items-center gap-2">
              <input type="number" id="calcAmount" value="100" min="10" step="1" 
                class="flex-1 px-3 sm:px-4 py-2 sm:py-3 rounded-2xl text-base sm:text-lg font-bold"
                style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9;">
              <span class="text-xs sm:text-sm font-semibold" style="color:#94a3b8;">USDT</span>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3 sm:gap-4">
            <div>
              <label class="text-xs sm:text-sm font-semibold block mb-2" style="color:#cbd5e1;">${t("calc.input.vip")}</label>
              <div id="calcVIP" class="px-3 sm:px-4 py-2 sm:py-3 rounded-2xl text-xs sm:text-sm font-bold" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35); color:#5eead4;">VIP1</div>
            </div>
            <div>
              <label class="text-xs sm:text-sm font-semibold block mb-2" style="color:#cbd5e1;">${t("calc.input.rate")}</label>
              <div id="calcRate" class="px-3 sm:px-4 py-2 sm:py-3 rounded-2xl text-xs sm:text-sm font-bold text-grad">2.3%</div>
            </div>
          </div>
          <div class="mt-3 sm:mt-4 text-xs leading-relaxed" style="color:#94a3b8;">${t("calc.input.note")}</div>
        </div>
      </div>
      <div class="card rounded-3xl p-4 sm:p-6 md:p-8">
        <h3 class="text-lg sm:text-xl font-extrabold mb-2 text-center" style="color:#5eead4;">${t("calc.output.title")}</h3>
        <p class="text-xs mb-4 sm:mb-6" style="color:#94a3b8;">${t("calc.output.note")}</p>
        <div class="space-y-3 sm:space-y-4">
          ${CalcResult("30", t("calc.output.d30"))}
          ${CalcResult("60", t("calc.output.d60"))}
          ${CalcResult("90", t("calc.output.d90"))}
        </div>
      </div>
    </div>
  </section>
  `;
}
function CalcResult(days, label) {
  return `
  <div class="rounded-2xl p-4 sm:p-5" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35);">
    <div class="flex items-center justify-between mb-2">
      <div class="text-xs sm:text-sm font-extrabold" style="color:#f1f5f9;">${days}${label}</div>
      <div class="text-xs" style="color:#94a3b8;">${t("calc.output.totalNote")}</div>
    </div>
    <div class="text-xl sm:text-2xl font-extrabold text-grad mb-1" id="calcProfit${days}">$0.00</div>
    <div class="text-xs" style="color:#94a3b8;">
      ${days}${t("calc.output.total")}: <span id="calcTotal${days}" class="font-semibold" style="color:#cbd5e1;">$0.00</span>
    </div>
  </div>`;
}

function Partners() {
  return `
  <section id="partners" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="text-center mb-6 sm:mb-8">
      <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("partners.title")}</h2>
      <p class="mt-2 text-xs sm:text-sm md:text-base px-2" style="color:#94a3b8; line-height: 1.6;">${t("partners.subtitle")}</p>
    </div>
    <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
      ${PartnerCard("Polygon", t("partners.p1.type"), "ğŸ”·")}
      ${PartnerCard("Ethereum", t("partners.p2.type"), "ğŸ’ ")}
      ${PartnerCard("BNB Chain", t("partners.p3.type"), "ğŸŸ¡")}
      ${PartnerCard("Onchain", t("partners.p4.type"), "ğŸ”µ")}
      ${PartnerCard("SafePal", t("partners.p5.type"), "ğŸ”µ")}
      ${PartnerCard("Exodus", t("partners.p6.type"), "ğŸ”µ")}
    </div>
  </section>
  `;
}
function PartnerCard(name, type, iconKey) {
  const logoMap = {
    "Onchain": "./images/logos/onchain.png",
    "SafePal": "./images/logos/safepal.png",
    "Exodus": "./images/logos/exodus.svg",
    "Polygon": "./images/logos/polygon.webp",
    "Ethereum": "./images/logos/ethereum.png",
    "BNB Chain": "./images/logos/bnb-logo.png"
  };
  
  const logoImg = logoMap[name] || iconKey;
  const isImage = logoImg && logoImg.startsWith("./");
  
  // Onchain ä½¿ç”¨æ›´å¤§çš„å›¾æ ‡å°ºå¯¸
  const isOnchain = name === "Onchain";
  const iconSizeClass = isOnchain ? "h-16 sm:h-20 w-16 sm:w-20" : "h-12 sm:h-16";
  const containerHeight = isOnchain ? "h-16 sm:h-20" : "h-12 sm:h-16";
  
  return `
  <div class="card rounded-3xl p-4 sm:p-6 text-center">
    <div class="mb-2 sm:mb-3 flex justify-center items-center ${containerHeight}">
      ${isImage ? `<img src="${logoImg}" alt="${name}" class="${iconSizeClass} object-contain" style="background: transparent; mix-blend-mode: normal;" />` : `<div class="text-3xl sm:text-4xl">${iconKey}</div>`}
    </div>
    <div class="text-base sm:text-lg font-extrabold mb-1" style="color:#f1f5f9;">${name}</div>
    <div class="text-xs" style="color:#94a3b8;">${type}</div>
  </div>`;
}

function UserTestimonials() {
  // Leaderboard data
  const leaderboardData = [
    ["0x3C...9B21", "+7,234.18", "144,682.36"],
    ["0x7D...4A89", "+5,623.75", "112,475.00"],
    ["0xE1...6F2C", "+4,231.56", "84,631.20"],
    ["0x2A...B7D4", "+3,156.89", "63,137.80"],
    ["0x8F...C9E1", "+2,145.32", "42,906.40"],
    ["0x5B...3D8A", "+1,856.74", "37,134.80"],
    ["0x9E...7F2B", "+1,234.56", "24,691.20"],
    ["0xA4...C3D1", "+8,123.45", "162,469.00"],
    ["0xB7...E5F2", "+6,789.12", "135,782.40"],
    ["0xC2...F8A9", "+5,456.78", "109,135.60"]
  ];
  
  const rows = leaderboardData.map(([wallet, daily, total]) => 
    LeaderboardRow(wallet, daily, total)
  ).join("");
  
  // Reviews data - mixed languages for authenticity (no Traditional Chinese, only 3 English)
  const reviewsData = [
    ["ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€ ĞŸĞµÑ‚Ñ€Ğ¾Ğ²", t("reviews.r1.comment"), "./images/avatar-1.jpg"],
    ["Mehmet YÄ±lmaz", t("reviews.r2.comment"), "./images/avatar-2.jpg"],
    ["ç”°ä¸­ ç¾å’²", t("reviews.r3.comment"), "./images/avatar-3.jpg"],
    ["ê¹€ë¯¼ìˆ˜", t("reviews.r4.comment"), "./images/avatar-4.jpg"],
    ["Carlos Silva", t("reviews.r5.comment"), "./images/avatar-5.jpeg"],
    ["Sophie Martin", t("reviews.r6.comment"), "./images/avatar-6.jpg"],
    ["Hans Weber", t("reviews.r7.comment"), "./images/avatar-7.jpg"],
    ["Marco Rossi", t("reviews.r8.comment"), "./images/avatar-8.jpg"],
    ["Emma Wilson", t("reviews.r9.comment"), "./images/avatar-9.jpg"],
    ["Jan de Vries", t("reviews.r10.comment"), "./images/avatar-10.jpg"],
    ["Anna Kowalska", t("reviews.r11.comment"), "./images/avatar-11.jpg"],
    ["Lisa Anderson", t("reviews.r12.comment"), "./images/avatar-12.jpg"],
    ["Erik Johansson", t("reviews.r13.comment"), "./images/avatar-13.jpg"],
    ["Ana Santos", t("reviews.r14.comment"), "./images/avatar-14.jpg"],
    ["David Lee", t("reviews.r15.comment"), "./images/avatar-15.jpg"],
    ["Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯", t("reviews.r16.comment"), "./images/avatar-1.jpg"],
    ["ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ", t("reviews.r17.comment"), "./images/avatar-2.jpg"],
    ["Ø®Ø§Ù„Ø¯ Ø­Ø³Ù†", t("reviews.r18.comment"), "./images/avatar-3.jpg"]
  ];
  
  const reviews = reviewsData.map(([name, comment, avatar]) => 
    ReviewItem(name, comment, avatar)
  ).join("");
  
  return `
  <section id="testimonials" class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="text-center mb-6 sm:mb-8">
      <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center" style="color:#5eead4;">${t("leaderboard.title")}</h2>
      <p class="mt-2 text-xs sm:text-sm md:text-base px-2" style="color:#94a3b8; line-height: 1.6;">${t("reviews.subtitle")}</p>
    </div>
    
    <div class="grid lg:grid-cols-2 gap-4 sm:gap-6">
      <div class="card rounded-3xl p-4 sm:p-6 md:p-8">
        <div class="overflow-hidden -mx-4 sm:mx-0 px-4 sm:px-0">
          <div class="leaderboard-scroll">
            <div class="leaderboard-wrapper">
              <table class="w-full min-w-[500px] sm:min-w-full" style="border-collapse: separate; border-spacing: 0;">
                <thead>
                  <tr>
                    <th class="text-left px-3 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-extrabold rounded-tl-2xl" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9; width: 40%;">${t("leaderboard.table.wallet")}</th>
                    <th class="text-right px-3 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-extrabold" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9; width: 30%;">${t("leaderboard.table.daily")}</th>
                    <th class="text-right px-3 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-extrabold rounded-tr-2xl" style="background: rgba(30,41,59,.70); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9; width: 30%;">${t("leaderboard.table.total")}</th>
                  </tr>
                </thead>
                <tbody>
                  ${rows}
                </tbody>
              </table>
              <table class="w-full min-w-[500px] sm:min-w-full" style="border-collapse: separate; border-spacing: 0;">
                <tbody>
                  ${rows}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card rounded-3xl p-4 sm:p-6 md:p-8 overflow-hidden">
        <div class="reviews-scroll">
          <div class="reviews-container">
            ${reviews}
            ${reviews}
          </div>
        </div>
      </div>
    </div>
  </section>
  `;
}
function LeaderboardRow(wallet, daily, total) {
  return `
  <tr>
    <td class="px-3 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-mono text-left" style="background: rgba(30,41,59,.50); border: 1px solid rgba(148,163,184,.35); color:#f1f5f9; width: 40%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${wallet}">${wallet}</td>
    <td class="px-3 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-bold text-right tabular-nums" style="background: rgba(30,41,59,.50); border: 1px solid rgba(148,163,184,.35); color:#10b981; width: 30%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${daily} USDT</td>
    <td class="px-3 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm text-right tabular-nums" style="background: rgba(30,41,59,.50); border: 1px solid rgba(148,163,184,.35); color:#cbd5e1; width: 30%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${total} USDT</td>
  </tr>`;
}

function ReviewItem(name, comment, avatar) {
  const isImage = avatar && avatar.startsWith("./");
  
  return `
  <div class="review-item rounded-2xl p-4 sm:p-5 flex-shrink-0" style="background: rgba(30,41,59,.60); border: 1px solid rgba(148,163,184,.35);">
    <div class="flex items-start gap-3 sm:gap-4">
      <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden" style="background: rgba(20,184,166,.20); border:1px solid rgba(20,184,166,.30);">
        ${isImage ? `<img src="${avatar}" alt="${name}" class="w-full h-full object-cover rounded-full" />` : `<span class="text-xl sm:text-2xl">${avatar || "ğŸ‘¤"}</span>`}
      </div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center justify-between gap-2 mb-1">
          <div class="text-sm sm:text-base font-extrabold" style="color:#f1f5f9;">${name}</div>
          <div class="flex items-center gap-1 flex-shrink-0">
            <span class="text-yellow-400 text-xs sm:text-sm">â˜…â˜…â˜…â˜…â˜…</span>
            <span class="text-xs" style="color:#94a3b8;">âœ“ Verified</span>
          </div>
        </div>
        <div class="text-xs sm:text-sm leading-relaxed break-words" style="color:#cbd5e1; word-wrap: break-word; overflow-wrap: break-word;">${comment}</div>
      </div>
    </div>
  </div>`;
}

function CustomerServiceButtons() {
  return `
  <div class="fixed bottom-4 right-4 sm:bottom-5 sm:right-5 z-50 flex flex-col gap-3">
    <a id="btnTGFloat" href="#" data-chat-type="telegram"
       class="flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 rounded-full shadow-lg transition-transform hover:scale-110 active:scale-95"
       style="background: linear-gradient(135deg, rgba(20,184,166,1), rgba(6,182,212,1)); min-width: 48px; min-height: 48px;">
      <img src="./images/telegram.png" alt="Telegram" class="w-7 h-7 sm:w-8 sm:h-8 object-contain" />
    </a>
    <a id="btnWAFloat" href="#" data-chat-type="whatsapp"
       class="flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 rounded-full shadow-lg transition-transform hover:scale-110 active:scale-95"
       style="background: linear-gradient(135deg, rgba(34,197,94,1), rgba(16,185,129,1)); min-width: 48px; min-height: 48px;">
      <img src="./images/whatsapp.png" alt="WhatsApp" class="w-7 h-7 sm:w-8 sm:h-8 object-contain" />
    </a>
  </div>
  `;
}

// ===== behaviors =====
function bindLinks() {
  const map = {
    telegram: LINKS.TG,
    whatsapp: LINKS.WA,
  };

  document.querySelectorAll("[data-chat-type]").forEach((el) => {
    const type = el.getAttribute("data-chat-type");
    const url = map[type] || "#";
    el.setAttribute("href", url);

    // If still '#', keep it on page. If real link, open new tab.
    el.addEventListener("click", (e) => {
      if (!url || url === "#") return; // stays on page
      e.preventDefault();
      window.open(url, "_blank", "noopener,noreferrer");
    });
  });
}

function bindGlobalBehaviors() {
  // Close lang menu when clicking outside
  document.addEventListener("click", (e) => {
    if (!e.target.closest("#langBtn") && !e.target.closest("#langMenu")) {
      $("#langMenu")?.classList.add("hidden");
    }
  });
  
}

function bindLangDropdown() {
  const LABELS = {
    en: "EN",
    ar: "AR",
    "zh-Hant": "ç¹é«”",
    es: "ES",
    fr: "FR",
    de: "DE",
    it: "IT",
    pt: "PT",
    ja: "JA",
    ko: "KO",
  };
  const FLAGS = {
    en: "./images/flags/en.png",
    ar: "./images/flags/ar.png",
    "zh-Hant": "./images/flags/tw.png",
    es: "./images/flags/es.png",
    fr: "./images/flags/fr.png",
    de: "./images/flags/de.png",
    it: "./images/flags/it.png",
    pt: "./images/flags/pt.png",
    ja: "./images/flags/ja.png",
    ko: "./images/flags/ko.png",
  };

  const setLabel = () => {
    const cur = window.__i18n?.lang || "en";
    const label = $("#langLabel");
    const flag = $("#langFlag");
    if (label) label.textContent = LABELS[cur] || cur;
    if (flag) {
      const flagPath = FLAGS[cur] || FLAGS.en;
      if (flag.tagName === "IMG") {
        flag.src = flagPath;
      } else {
        flag.innerHTML = `<img src="${flagPath}" alt="${cur}" class="w-4 h-4 sm:w-5 sm:h-5 rounded flex-shrink-0" />`;
      }
    }
  };

  const langBtn = $("#langBtn");
  const langMenu = $("#langMenu");

  if (langBtn) {
    // Remove existing listeners by cloning
    const newLangBtn = langBtn.cloneNode(true);
    langBtn.parentNode?.replaceChild(newLangBtn, langBtn);
    
    newLangBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      e.preventDefault();
      const menu = $("#langMenu");
      if (menu) {
        const isHidden = menu.classList.contains("hidden");
        if (isHidden) {
          menu.classList.remove("hidden");
        } else {
          menu.classList.add("hidden");
        }
      }
    });
  }

  if (langMenu) {
    // Remove old event listeners to prevent duplicates
    langMenu.querySelectorAll("button[data-lang]").forEach((btn) => {
      const newBtn = btn.cloneNode(true);
      btn.parentNode?.replaceChild(newBtn, btn);
      
      newBtn.addEventListener("click", async (e) => {
        e.stopPropagation();
        e.preventDefault();
        const lang = newBtn.getAttribute("data-lang");
        if (lang && window.__i18n) {
          try {
            await window.__i18n.setLang(lang);
            const menu = $("#langMenu");
            if (menu) {
              menu.classList.add("hidden");
            }
          } catch (err) {
            console.error("Failed to change language:", err);
          }
        }
      });
    });
  }

  setLabel();
  window.addEventListener("i18n:changed", setLabel);
}

function bindFAQ() {
  document.querySelectorAll(".faq").forEach((item) => {
    // Remove old event listeners by cloning
    const newItem = item.cloneNode(true);
    item.parentNode?.replaceChild(newItem, item);
    
    const btn = newItem.querySelector("button");
    const body = newItem.querySelector("div[class*='px-']");
    
    if (btn && body) {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        e.preventDefault();
        
        const isOpen = !body.classList.contains("hidden");
        const icon = btn.querySelector("div:last-child");
        
        // Close all other FAQ items
        document.querySelectorAll(".faq").forEach((otherItem) => {
          if (otherItem !== newItem) {
            const otherBody = otherItem.querySelector("div[class*='px-']");
            const otherIcon = otherItem.querySelector("button div:last-child");
            if (otherBody) otherBody.classList.add("hidden");
            if (otherIcon) otherIcon.textContent = "+";
          }
        });
        
        // Toggle current item
        if (isOpen) {
          body.classList.add("hidden");
          if (icon) icon.textContent = "+";
        } else {
          body.classList.remove("hidden");
          if (icon) icon.textContent = "âˆ’";
        }
      });
    }
  });
}

function setYear() {
  const y = $("#year");
  if (y) y.textContent = String(new Date().getFullYear());
}

function bindCalculator() {
  const amountInput = $("#calcAmount");
  const vipDisplay = $("#calcVIP");
  const rateDisplay = $("#calcRate");
  
  const VIP_RATES = {
    VIP1: 2.3,
    VIP2: 2.7,
    VIP3: 3.5,
    VIP4: 4.0,
    VIP5: 4.5,
    VIP6: 5.0,
    VIP7: 6.0,
    VIP8: 8.0
  };
  
  const VIP_RANGES = [
    { min: 10, max: 3000, level: "VIP1" },
    { min: 3001, max: 10000, level: "VIP2" },
    { min: 10001, max: 20000, level: "VIP3" },
    { min: 20001, max: 50000, level: "VIP4" },
    { min: 50001, max: 100000, level: "VIP5" },
    { min: 100001, max: 300000, level: "VIP6" },
    { min: 300001, max: 500000, level: "VIP7" },
    { min: 500001, max: Infinity, level: "VIP8" }
  ];
  
  function getVIPLevel(amount) {
    for (const range of VIP_RANGES) {
      if (amount >= range.min && amount <= range.max) {
        return range.level;
      }
    }
    return "VIP1";
  }
  
  function calculateCompound(principal, dailyRate, days) {
    let total = principal;
    for (let i = 0; i < days; i++) {
      total = total * (1 + dailyRate / 100);
    }
    return total;
  }
  
  function updateCalculator() {
    const amount = parseFloat(amountInput?.value || 100);
    if (isNaN(amount) || amount < 10) return;
    
    const vipLevel = getVIPLevel(amount);
    const dailyRate = VIP_RATES[vipLevel];
    
    if (vipDisplay) vipDisplay.textContent = vipLevel;
    if (rateDisplay) rateDisplay.textContent = `${dailyRate}%`;
    
    [30, 60, 90].forEach(days => {
      const total = calculateCompound(amount, dailyRate, days);
      const profit = total - amount;
      const profitEl = $(`#calcProfit${days}`);
      const totalEl = $(`#calcTotal${days}`);
      
      if (profitEl) profitEl.textContent = `$${profit.toFixed(2)}`;
      if (totalEl) totalEl.textContent = `$${total.toFixed(2)}`;
    });
  }
  
  if (amountInput) {
    amountInput.addEventListener("input", updateCalculator);
    updateCalculator();
  }
}

// ===== boot =====
async function init() {
  try {
    // Hide loading immediately if DOM is ready
    const loading = document.getElementById("loading");
    
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", async () => {
        await loadAndRender(loading);
      });
    } else {
      await loadAndRender(loading);
    }
  } catch (err) {
    const app = $("#app");
    const loading = document.getElementById("loading");
    if (loading) {
      loading.classList.add("hidden");
      setTimeout(() => loading.remove(), 100);
    }
    if (app) {
      app.innerHTML = `
        <div class="max-w-3xl mx-auto px-6 py-16">
          <div class="card rounded-3xl p-8">
            <h1 class="text-2xl font-extrabold" style="color:#f1f5f9;">âš ï¸ ${String(err?.name || "Error")}</h1>
            <p class="mt-2" style="color:#94a3b8;">${err?.message || "é¡µé¢åŠ è½½å¤±è´¥"}</p>
            <pre class="mt-4 text-xs whitespace-pre-wrap" style="color:#64748b;">${String(err?.message || err)}</pre>
          </div>
        </div>
      `;
    }
  }
}

async function loadAndRender(loading) {
  // Hide loading overlay immediately (50ms) to show content faster
  if (loading) {
    setTimeout(() => {
      loading.classList.add("hidden");
      setTimeout(() => loading.remove(), 100);
    }, 50);
  }
  
  try {
    // Load i18n with timeout fallback (max 1.5 seconds for faster display)
    const i18nPromise = initI18n();
    const timeoutPromise = new Promise((resolve) => setTimeout(resolve, 1500));
    
    await Promise.race([i18nPromise, timeoutPromise]);
    
    // Render with translations (or fallback if timeout)
    render();
    
    // Bind all interactions after render
    bindLangDropdown();
    bindFAQ();
    bindLinks();
    bindGlobalBehaviors();
    bindCalculator();
    setYear();
  } catch (err) {
    // If i18n fails, still show content with fallback immediately
    render();
    bindLangDropdown();
    bindFAQ();
    bindLinks();
    bindGlobalBehaviors();
    bindCalculator();
    setYear();
    
    if (loading) {
      loading.classList.add("hidden");
      setTimeout(() => loading.remove(), 100);
    }
    console.warn("i18n load failed, using fallback:", err);
  }
}

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", init);
} else {
  init();
}

// Re-render on language change
window.addEventListener("i18n:changed", () => {
  render();
  // Re-bind all interactions after re-render
  bindLangDropdown();
  bindFAQ();
  bindLinks();
  bindGlobalBehaviors();
  bindCalculator();
  setYear();
});
